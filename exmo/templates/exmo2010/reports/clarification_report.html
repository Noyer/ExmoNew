{% extends "exmo2010/base_site.html" %}
{% comment %}
# This file is part of EXMO2010 software.
# Copyright 2010, 2011 Al Nikolov
# Copyright 2010, 2011 non-profit partnership Institute of Information Freedom Development
# Copyright 2012, 2013 Foundation "Institute for Information Freedom Development"
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU Affero General Public License as
#    published by the Free Software Foundation, either version 3 of the
#    License, or (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU Affero General Public License for more details.
#
#    You should have received a copy of the GNU Affero General Public License
#    along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
{% endcomment %}
{% load i18n adminmedia %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}exmo2010/css/reports_manager.css"/>
{% endblock %}

{% block extrahead %}{{ block.super }}
    {% url django.views.i18n.javascript_catalog as jsi18nurl %}
    <script type="text/javascript" src="{{ jsi18nurl|default:"/jsi18n/" }}"></script>
    {{ media }}

    {% if all_clarifications %}

    <script type="text/javascript" src="{{STATIC_URL}}exmo2010/js/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}exmo2010/js/reports_manager.js"></script>

    {% endif %}

{% endblock %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
        <a href="/">{% trans "Home" %}</a><span>&rsaquo;</span>
        <a href="{% url exmo2010:monitoring_list %}">{% trans 'Monitoring' %}</a><span>&rsaquo;</span>
        <span class="title">{{ title }}</span>
    </div>
{% endblock %}
{% block pretitle %}
    {% include "exmo2010/monitoring_utility.html" %}
{% endblock %}

{% block content %}

    {% if all_clarifications %}
    <form action="" method="post" id="cform">
        {% csrf_token %}
        <table class="messages-report">
            <thead>
            <tr>
                <th class="date">{% trans 'Date and time' %}</th>
                <th class="addressee">{% trans 'Clarification addressee' %}<br/>{{ form.addressee }}</th>
                <th class="creator">{% trans 'Clarification creator' %}<br/>{{ form.creator }}</th>
                <th class="link">{% trans 'Link to clarification' %}</th>
            </tr>
            </thead>
        </table>

        {% if opened_clarifications %}
        <table class="messages-report">
            <tbody>
                <tr>
                    <td class="title open">
                        {% trans 'Without answer' %}
                        ({{ opened_clarifications.count }})
                    </td>
                </tr>
            </tbody>
        </table>

        <table class="messages-report open">
            <tbody>
                {% for op in opened_clarifications %}
                <tr>
                    <td class="date">{{ op.open_date|date:"H:i d.m.Y" }}</td>
                    <td class="addressee">{{ op.addressee.profile.legal_name }}</td>
                    <td class="creator">{{ op.creator.profile.legal_name }}</td>
                    <td class="link">
                        <a href="{% url exmo2010:score_view op.score.pk %}#clarifications" target="_blank">{% trans 'go to clarification' %}</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if closed_clarifications %}
        <table class="messages-report">
            <tbody>
                <tr>
                    <td class="title closed">
                        {% trans 'Processed' %}
                        ({{ closed_clarifications.count }})
                    </td>
                </tr>
            </tbody>
        </table>

        <table class="messages-report closed">
            <tbody>
                {% for cp in closed_clarifications %}
                <tr>
                    <td class="date">{{ cp.open_date|date:"H:i d.m.Y" }}</td>
                    <td class="addressee">{{ cp.addressee.profile.legal_name }}</td>
                    <td class="creator">{{ cp.creator.profile.legal_name }}</td>
                    <td class="link">
                        <a href="{% url exmo2010:score_view cp.score.pk %}#clarifications" target="_blank">{% trans 'go to clarification' %}</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </form>
    {% else %}
    <p>{% trans "There are no clarifications" %}</p>
    {% endif %}

{% endblock %}
